"""
sprites.py - 小铁皮的像素精灵图数据
基于 Claude 的形象设计：10x9 像素，有小耳朵的暖色调小方块
"""

from typing import List, Dict, Tuple


def hex_to_rgb(hex_color: str) -> Tuple[int, int, int]:
    """十六进制颜色转 RGB"""
    hex_color = hex_color.lstrip('#')
    return tuple(int(hex_color[i:i+2], 16) for i in (0, 2, 4))


def rgb_to_hex(r: int, g: int, b: int) -> str:
    """RGB 转十六进制颜色"""
    return f'#{r:02X}{g:02X}{b:02X}'


def lerp_color(color1: str, color2: str, t: float) -> str:
    """在两个颜色之间插值，t 从 0 到 1"""
    r1, g1, b1 = hex_to_rgb(color1)
    r2, g2, b2 = hex_to_rgb(color2)
    r = int(r1 + (r2 - r1) * t)
    g = int(g1 + (g2 - g1) * t)
    b = int(b1 + (b2 - b1) * t)
    return rgb_to_hex(r, g, b)

# 基础调色板 - Claude 暖色调
COLORS: Dict[int, str] = {
    0: '',           # 透明
    1: '#D4856A',    # 身体 - 暖珊瑚色（基准）
    2: '#2D2D2D',    # 眼睛 - 炭黑色
    3: '#B86E55',    # 深色 - 闭眼/阴影（基准）
    4: '#E8A08E',    # 浅色 - 高光
    5: '#6B8E23',    # 绿色 - 脏脏的臭味
    6: '#87CEEB',    # 蓝色 - 汗水/眼泪
    7: '#808080',    # 灰色 - 死亡
    8: '#FF6B6B',    # 红色 - 生气
}

# 活力值影响的颜色范围
# 活力值低（0）→ 很淡的颜色
# 活力值中（50）→ 基准颜色
# 活力值高（100）→ 很深的颜色
COLOR_FADED = {
    1: '#F0D0C4',    # 很淡的珊瑚色（褪色）
    3: '#E0B8A8',    # 很淡的阴影色
}
COLOR_VIBRANT = {
    1: '#A85540',    # 很深的橙色（充满活力）
    3: '#8B4030',    # 很深的阴影色
}


def get_dynamic_colors(vitality: float) -> Dict[int, str]:
    """
    根据活力值返回动态调色板
    vitality: 0-100
    """
    colors = COLORS.copy()

    # 归一化到 0-1
    t = max(0, min(100, vitality)) / 100.0

    # 身体颜色根据活力值变化
    if t < 0.5:
        # 0-50: 从褪色到基准
        ratio = t / 0.5
        colors[1] = lerp_color(COLOR_FADED[1], COLORS[1], ratio)
        colors[3] = lerp_color(COLOR_FADED[3], COLORS[3], ratio)
    else:
        # 50-100: 从基准到深色
        ratio = (t - 0.5) / 0.5
        colors[1] = lerp_color(COLORS[1], COLOR_VIBRANT[1], ratio)
        colors[3] = lerp_color(COLORS[3], COLOR_VIBRANT[3], ratio)

    return colors

PIXEL_SIZE = 7  # 每个像素的实际大小

# ═══════════════════════════════════════════════════════════════
#  精灵图定义 (10 wide × 9 tall)
#  0 = 透明, 1 = 身体, 2 = 眼睛, 3 = 深色
# ═══════════════════════════════════════════════════════════════

# 正常状态
SPRITE_IDLE: List[List[int]] = [
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
    [0, 1, 1, 1, 1, 1, 1, 1, 1, 0],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 2, 2, 1, 1, 2, 2, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
]

# 眨眼
SPRITE_BLINK: List[List[int]] = [
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
    [0, 1, 1, 1, 1, 1, 1, 1, 1, 0],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 3, 3, 1, 1, 3, 3, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
]

# 开心 - 眯眼笑
SPRITE_HAPPY: List[List[int]] = [
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
    [0, 1, 1, 1, 1, 1, 1, 1, 1, 0],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 3, 3, 1, 1, 3, 3, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 1, 4, 4, 4, 4, 1, 1, 1],
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
]

# 走路 A - 腿分开
SPRITE_WALK_A: List[List[int]] = [
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
    [0, 1, 1, 1, 1, 1, 1, 1, 1, 0],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 2, 2, 1, 1, 2, 2, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 0, 0, 0, 0, 0, 0, 1, 1],
    [1, 1, 0, 0, 0, 0, 0, 0, 1, 1],
]

# 走路 B - 腿并拢
SPRITE_WALK_B: List[List[int]] = [
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
    [0, 1, 1, 1, 1, 1, 1, 1, 1, 0],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 2, 2, 1, 1, 2, 2, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [0, 0, 1, 1, 0, 0, 1, 1, 0, 0],
    [0, 0, 1, 1, 0, 0, 1, 1, 0, 0],
]

# 饥饿 - 大眼睛
SPRITE_HUNGRY: List[List[int]] = [
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
    [0, 1, 1, 1, 1, 1, 1, 1, 1, 0],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 2, 2, 1, 1, 2, 2, 1, 1],
    [1, 1, 2, 2, 1, 1, 2, 2, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 1, 1, 3, 3, 1, 1, 1, 1],
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
]

# 脏脏 - 有臭味符号
SPRITE_DIRTY: List[List[int]] = [
    [0, 1, 1, 0, 5, 0, 0, 1, 1, 5],
    [0, 1, 1, 1, 1, 1, 1, 1, 1, 0],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 2, 2, 1, 1, 2, 2, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [5, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
    [0, 1, 1, 0, 5, 0, 5, 1, 1, 0],
]

# 不开心/伤心 - 流泪
SPRITE_SAD: List[List[int]] = [
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
    [0, 1, 1, 1, 1, 1, 1, 1, 1, 0],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 2, 2, 1, 1, 2, 2, 1, 1],
    [1, 1, 1, 6, 1, 1, 1, 6, 1, 1],
    [1, 1, 1, 1, 3, 3, 1, 1, 1, 1],
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
]

# 生病 - 颜色变暗，冒冷汗
SPRITE_SICK: List[List[int]] = [
    [0, 3, 3, 0, 0, 6, 0, 3, 3, 0],
    [0, 3, 3, 3, 3, 3, 3, 3, 3, 0],
    [3, 3, 3, 3, 3, 3, 3, 3, 3, 3],
    [3, 3, 3, 3, 3, 3, 3, 3, 3, 3],
    [3, 3, 2, 2, 3, 3, 2, 2, 3, 3],
    [3, 3, 3, 3, 3, 3, 3, 3, 3, 3],
    [3, 3, 3, 3, 3, 3, 3, 3, 3, 3],
    [0, 3, 3, 0, 0, 0, 0, 3, 3, 0],
    [0, 3, 3, 0, 0, 0, 0, 3, 3, 0],
]

# 睡觉 - 蜷成一团 + 睡帽
SPRITE_SLEEP: List[List[int]] = [
    [0, 0, 0, 0, 0, 3, 3, 1, 0, 0],
    [0, 0, 0, 0, 3, 1, 1, 1, 3, 0],
    [0, 0, 0, 1, 1, 1, 1, 1, 1, 0],
    [0, 0, 1, 1, 1, 1, 1, 1, 1, 1],
    [0, 0, 1, 1, 3, 3, 1, 1, 1, 1],
    [0, 0, 1, 1, 1, 1, 1, 1, 1, 1],
    [0, 1, 1, 1, 1, 1, 1, 1, 1, 0],
    [0, 1, 1, 1, 1, 1, 1, 1, 0, 0],
    [0, 0, 1, 1, 1, 1, 1, 0, 0, 0],
]

# 生气 - 皱眉 + 眼睛竖起来
SPRITE_ANGRY: List[List[int]] = [
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
    [0, 1, 1, 1, 1, 1, 1, 1, 1, 0],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 3, 1, 1, 1, 1, 3, 1, 1],
    [1, 1, 1, 2, 1, 1, 2, 1, 1, 1],
    [1, 1, 1, 2, 1, 1, 2, 1, 1, 1],
    [1, 1, 1, 3, 3, 3, 3, 1, 1, 1],
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
]

# 死亡 - 变灰 + X眼
SPRITE_DEAD: List[List[int]] = [
    [0, 7, 7, 0, 0, 0, 0, 7, 7, 0],
    [0, 7, 7, 7, 7, 7, 7, 7, 7, 0],
    [7, 7, 7, 7, 7, 7, 7, 7, 7, 7],
    [7, 7, 7, 7, 7, 7, 7, 7, 7, 7],
    [7, 2, 7, 2, 7, 7, 2, 7, 2, 7],
    [7, 7, 2, 7, 7, 7, 7, 2, 7, 7],
    [7, 7, 7, 7, 7, 7, 7, 7, 7, 7],
    [0, 7, 7, 0, 0, 0, 0, 7, 7, 0],
    [0, 7, 7, 0, 0, 0, 0, 7, 7, 0],
]

# 寂寞 - 耳朵耷拉
SPRITE_LONELY: List[List[int]] = [
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 1, 1, 1, 1, 1, 1, 1, 1, 0],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 2, 2, 1, 1, 2, 2, 1, 1],
    [1, 1, 1, 1, 3, 3, 1, 1, 1, 1],
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
]

# 晕倒 - 躺平
SPRITE_DIZZY: List[List[int]] = [
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 1, 1, 0, 0, 0, 0, 0, 0, 0],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 3, 1, 3, 1, 1, 3, 1, 3, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [0, 1, 1, 1, 1, 1, 1, 1, 1, 0],
    [0, 0, 0, 0, 0, 0, 0, 1, 1, 0],
]

SPRITE_YAWN: List[List[int]] = [
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
    [0, 1, 1, 1, 1, 1, 1, 1, 1, 0],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 3, 3, 1, 1, 3, 3, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 1, 2, 2, 2, 2, 1, 1, 1],
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
]

SPRITE_SIT: List[List[int]] = [
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
    [0, 1, 1, 1, 1, 1, 1, 1, 1, 0],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 2, 2, 1, 1, 2, 2, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [0, 0, 1, 1, 0, 0, 1, 1, 0, 0],
]

SPRITE_RUN_A: List[List[int]] = [
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
    [0, 1, 1, 1, 1, 1, 1, 1, 1, 0],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 2, 2, 1, 1, 2, 2, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [0, 1, 1, 0, 0, 0, 0, 0, 1, 1],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
]

SPRITE_RUN_B: List[List[int]] = [
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
    [0, 1, 1, 1, 1, 1, 1, 1, 1, 0],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 2, 2, 1, 1, 2, 2, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 0, 0, 0, 0, 0, 0, 1, 1],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
]

SPRITE_HOP: List[List[int]] = [
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
    [0, 1, 1, 1, 1, 1, 1, 1, 1, 0],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 3, 3, 1, 1, 3, 3, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [0, 0, 0, 1, 1, 1, 1, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
]

SPRITE_LOOK_LEFT: List[List[int]] = [
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
    [0, 1, 1, 1, 1, 1, 1, 1, 1, 0],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 2, 2, 1, 1, 2, 2, 1, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
]

SPRITE_LOOK_RIGHT: List[List[int]] = [
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
    [0, 1, 1, 1, 1, 1, 1, 1, 1, 0],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 1, 2, 2, 1, 1, 2, 2, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
]

SPRITE_LOOK_UP: List[List[int]] = [
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
    [0, 1, 1, 1, 1, 1, 1, 1, 1, 0],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 2, 2, 1, 1, 2, 2, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
]


# ═══════════════════════════════════════════════════════════════
#  状态到精灵帧的映射
# ═══════════════════════════════════════════════════════════════

def _make_fat(sprite: List[List[int]]) -> List[List[int]]:
    result = []
    for i, row in enumerate(sprite):
        if i < 6:
            new_row = [0] + row + [0]
        else:
            if row[0] == 0 and row[-1] == 0:
                new_row = [0] + [row[1]] + row[1:-1] + [row[-2]] + [0]
            else:
                new_row = [row[0]] + row + [row[-1]]
        result.append(new_row)
    return result

def _make_thin(sprite: List[List[int]]) -> List[List[int]]:
    result = []
    for i, row in enumerate(sprite):
        if i < 6:
            new_row = row[:]
        else:
            new_row = row[:]
            if row[0] != 0:
                new_row[0] = 0
            if row[-1] != 0:
                new_row[-1] = 0
            if row[1] != 0 and i >= 7:
                new_row[1] = 0
            if row[-2] != 0 and i >= 7:
                new_row[-2] = 0
        result.append(new_row)
    return result

_BASE_SPRITES = {
    'idle': [SPRITE_IDLE, SPRITE_BLINK],
    'happy': [SPRITE_HAPPY],
    'hungry': [SPRITE_HUNGRY, SPRITE_IDLE],
    'dirty': [SPRITE_DIRTY],
    'sad': [SPRITE_SAD],
    'sick': [SPRITE_SICK],
    'sleep': [SPRITE_SLEEP],
    'angry': [SPRITE_ANGRY],
    'dead': [SPRITE_DEAD],
    'lonely': [SPRITE_LONELY],
    'dizzy': [SPRITE_DIZZY],
    'walk': [SPRITE_WALK_A, SPRITE_WALK_B],
    'run': [SPRITE_RUN_A, SPRITE_RUN_B],
    'hop': [SPRITE_HOP],
    'yawn': [SPRITE_YAWN],
    'sit': [SPRITE_SIT],
    'look_left': [SPRITE_LOOK_LEFT],
    'look_right': [SPRITE_LOOK_RIGHT],
    'look_up': [SPRITE_LOOK_UP],
}

SPRITES: Dict[str, Dict[str, List[List[List[int]]]]] = {
    'normal': {},
    'fat': {},
    'thin': {},
}

for state, frames in _BASE_SPRITES.items():
    SPRITES['normal'][state] = frames
    SPRITES['fat'][state] = [_make_fat(f) for f in frames]
    SPRITES['thin'][state] = [_make_thin(f) for f in frames]


# ═══════════════════════════════════════════════════════════════
#  季节装饰配件（叠加在基础精灵图上）
#  9 = 红色（围巾）, 10 = 粉色（花瓣）, 11 = 青色（冰饮）, 12 = 棕色（贝雷帽）
# ═══════════════════════════════════════════════════════════════

SEASON_COLORS: Dict[int, str] = {
    9: '#E74C3C',    # 红色 - 围巾
    10: '#FFB6C1',   # 粉色 - 花瓣
    11: '#5DADE2',   # 青色 - 冰饮
    12: '#8B4513',   # 棕色 - 贝雷帽
    13: '#F4D03F',   # 黄色 - 落叶
    14: '#FFFFFF',   # 白色 - 冰块/雪
}

# 冬天 - 红色围巾（绕在脖子上）
ACCESSORY_SCARF: List[List[int]] = [
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 9, 9, 9, 9, 9, 9, 9, 9, 0],
    [0, 0, 9, 9, 0, 0, 0, 0, 0, 0],
    [0, 0, 9, 9, 0, 0, 0, 0, 0, 0],
]

# 春天 - 头顶小花瓣
ACCESSORY_FLOWER: List[List[int]] = [
    [0, 0, 0, 10, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
]

# 夏天 - 手拿冰饮
ACCESSORY_DRINK: List[List[int]] = [
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 11],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 11],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 14],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 11],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 11],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
]

# 秋天 - 贝雷帽
ACCESSORY_BERET: List[List[int]] = [
    [0, 0, 12, 12, 12, 12, 12, 0, 0, 0],
    [0, 12, 12, 12, 12, 12, 12, 12, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
]

# 季节配件映射
SEASON_ACCESSORIES: Dict[str, List[List[int]]] = {
    'winter': ACCESSORY_SCARF,
    'spring': ACCESSORY_FLOWER,
    'summer': ACCESSORY_DRINK,
    'autumn': ACCESSORY_BERET,
}


# ═══════════════════════════════════════════════════════════════
#  动画道具像素图
# ═══════════════════════════════════════════════════════════════

# 动画相关颜色
ANIMATION_COLORS: Dict[int, str] = {
    15: '#A0A0A0',  # 金属灰 - 喷头主体
    16: '#606060',  # 深灰 - 喷孔
    17: '#87CEEB',  # 浅蓝 - 水滴
    18: '#FFFFFF',  # 白色 - 米饭
    19: '#1A1A1A',  # 黑色 - 海苔
    20: '#2D2D2D',  # 深灰 - 手柄主体
    21: '#4A4A4A',  # 浅灰 - 按钮区
    22: '#4169E1',  # 蓝色 - 手柄灯条
    # 梦境/新增元素颜色
    23: '#FFD700',  # 金色 - 星星
    24: '#FF69B4',  # 粉色 - 爱心
    25: '#87CEEB',  # 天蓝 - 彩虹蓝
    26: '#90EE90',  # 浅绿 - 彩虹绿
    27: '#4B0082',  # 深紫 - 噩梦云
    28: '#FFD700',  # 亮黄 - 闪电
    29: '#FF4500',  # 红橙 - 惊叹号/愤怒标记
    30: '#8B4513',  # 棕色 - 饼干
    31: '#D2691E',  # 巧克力点
    32: '#FF1493',  # 深粉 - 音符
    33: '#00CED1',  # 深青 - 蝴蝶翅膀
}

# 喷头 (6 wide x 3 tall)
SPRITE_SHOWER_HEAD: List[List[int]] = [
    [0,  15, 15, 15, 15, 0 ],
    [15, 16, 16, 16, 16, 15],
    [0,  16,  0, 16,  0, 16],
]

# 饭团 (5 wide x 5 tall)
SPRITE_ONIGIRI: List[List[int]] = [
    [0,  0, 18,  0,  0],
    [0, 18, 18, 18,  0],
    [18, 18, 18, 18, 18],
    [19, 19, 19, 19, 19],
    [0, 18, 18, 18,  0],
]

# PS4 手柄 (7 wide x 4 tall)
SPRITE_PS4_CONTROLLER: List[List[int]] = [
    [20,  0,  0,  0,  0,  0, 20],
    [20, 20, 21, 21, 21, 20, 20],
    [0,  20, 20, 20, 20, 20,  0],
    [0,   0, 20, 20, 20,  0,  0],
]

# ═══════════════════════════════════════════════════════════════
#  梦境气泡 (8 wide x 6 tall)
# ═══════════════════════════════════════════════════════════════

# 美梦气泡框架
SPRITE_DREAM_CLOUD: List[List[int]] = [
    [0, 14, 14, 14, 14, 14, 14, 0],
    [14,  4,  4,  4,  4,  4,  4, 14],
    [14,  4,  0,  0,  0,  0,  4, 14],
    [14,  4,  0,  0,  0,  0,  4, 14],
    [14,  4,  4,  4,  4,  4,  4, 14],
    [0,  0, 14, 14, 14,  0,  0,  0],
]

# 噩梦气泡框架
SPRITE_NIGHTMARE_CLOUD: List[List[int]] = [
    [0,  7,  7,  7,  7,  7,  7, 0],
    [7, 27, 27, 27, 27, 27, 27, 7],
    [7, 27,  0,  0,  0,  0, 27, 7],
    [7, 27,  0,  0,  0,  0, 27, 7],
    [7, 27, 27, 27, 27, 27, 27, 7],
    [0,  0,  7,  7,  7,  0,  0, 0],
]

# 梦境图标 (3x3)
DREAM_ICON_STAR: List[List[int]] = [
    [0, 23, 0],
    [23, 23, 23],
    [0, 23, 0],
]

DREAM_ICON_HEART: List[List[int]] = [
    [24, 0, 24],
    [24, 24, 24],
    [0, 24, 0],
]

DREAM_ICON_RAINBOW: List[List[int]] = [
    [29, 29, 29],
    [23, 23, 23],
    [25, 25, 25],
]

# 噩梦图标 (3x3)
NIGHTMARE_ICON_LIGHTNING: List[List[int]] = [
    [0, 28, 28],
    [28, 28, 0],
    [0, 28, 0],
]

NIGHTMARE_ICON_SKULL: List[List[int]] = [
    [14, 14, 14],
    [2, 14, 2],
    [0, 2, 0],
]

NIGHTMARE_ICON_EXCLAIM: List[List[int]] = [
    [0, 29, 0],
    [0, 29, 0],
    [0, 29, 0],
]

# ═══════════════════════════════════════════════════════════════
#  睡眠打扰精灵图
# ═══════════════════════════════════════════════════════════════

# 迷迷糊糊 - 一只眼睁开一只半闭
SPRITE_SLEEPY_DISTURBED: List[List[int]] = [
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
    [0, 1, 1, 1, 1, 1, 1, 1, 1, 0],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 2, 2, 1, 1, 3, 3, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 1, 1, 3, 1, 1, 1, 1, 1],
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
]

# 不耐烦 - 皱眉 + 怒气标记
SPRITE_ANNOYED_SLEEPY: List[List[int]] = [
    [0, 1, 1, 0, 0, 0, 29, 1, 1, 0],
    [0, 1, 1, 1, 1, 1, 1, 29, 1, 0],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 3, 1, 1, 1, 1, 3, 1, 1],
    [1, 1, 1, 2, 1, 1, 2, 1, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 1, 3, 3, 3, 3, 1, 1, 1],
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
]

# 超级不爽 - 生气 + 黑眼圈
SPRITE_SUPER_ANNOYED: List[List[int]] = [
    [0, 1, 1, 0, 29, 29, 0, 1, 1, 0],
    [0, 1, 1, 1, 1, 1, 1, 1, 1, 0],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 3, 1, 1, 1, 1, 3, 1, 1],
    [1, 3, 1, 2, 1, 1, 2, 1, 3, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 3, 3, 3, 3, 3, 3, 1, 1],
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
]

# 被安慰 - 开心闭眼
SPRITE_COMFORTED: List[List[int]] = [
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
    [0, 1, 1, 1, 1, 1, 1, 1, 1, 0],
    [0, 1, 1, 1, 1, 1, 1, 1, 1, 0],
    [0, 1, 1, 3, 1, 1, 3, 1, 1, 0],
    [0, 1, 1, 1, 1, 1, 1, 1, 1, 0],
    [0, 1, 1, 1, 4, 4, 1, 1, 1, 0],
    [0, 0, 1, 1, 0, 0, 1, 1, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
]

# ═══════════════════════════════════════════════════════════════
#  随机开心事件配件
# ═══════════════════════════════════════════════════════════════

# 蝴蝶 (5 wide x 4 tall)
SPRITE_BUTTERFLY: List[List[int]] = [
    [33, 0, 0, 0, 33],
    [33, 33, 2, 33, 33],
    [33, 0, 2, 0, 33],
    [0,  0, 2, 0,  0],
]

# 饼干 (4 wide x 3 tall)
SPRITE_COOKIE: List[List[int]] = [
    [0, 30, 30, 0],
    [30, 31, 30, 30],
    [0, 30, 31, 0],
]

# 音符 (3 wide x 5 tall)
SPRITE_MUSIC_NOTE: List[List[int]] = [
    [0, 32, 32],
    [0, 32, 0],
    [0, 32, 0],
    [32, 32, 0],
    [32, 32, 0],
]

# ═══════════════════════════════════════════════════════════════
#  阅读论文精灵图
# ═══════════════════════════════════════════════════════════════

# 阅读中 - 戴眼镜
SPRITE_READING: List[List[int]] = [
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
    [0, 1, 1, 1, 1, 1, 1, 1, 1, 0],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 7, 2, 7, 7, 7, 2, 7, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
]

# 阅读中眼睛左看
SPRITE_READING_LEFT: List[List[int]] = [
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
    [0, 1, 1, 1, 1, 1, 1, 1, 1, 0],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 2, 7, 7, 7, 2, 7, 7, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
]

# 阅读中眼睛右看
SPRITE_READING_RIGHT: List[List[int]] = [
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
    [0, 1, 1, 1, 1, 1, 1, 1, 1, 0],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 7, 7, 2, 7, 7, 7, 2, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
]

# 推眼镜帧1
SPRITE_PUSH_GLASSES_1: List[List[int]] = [
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
    [0, 1, 1, 1, 1, 1, 1, 1, 1, 0],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 7, 2, 7, 7, 7, 2, 7, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
]

# 推眼镜帧2
SPRITE_PUSH_GLASSES_2: List[List[int]] = [
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
    [0, 1, 1, 1, 1, 1, 1, 1, 1, 0],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 7, 2, 7, 7, 7, 2, 7, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
    [0, 1, 1, 0, 0, 0, 0, 1, 1, 0],
]

# 论文配件 (4 wide x 3 tall)
SPRITE_PAPER: List[List[int]] = [
    [14, 14, 14, 14],
    [14,  7, 14,  7],
    [14, 14, 14, 14],
]

_EXTRA_SPRITES = {
    'sleepy_disturbed': [SPRITE_SLEEPY_DISTURBED],
    'annoyed_sleepy': [SPRITE_ANNOYED_SLEEPY],
    'super_annoyed': [SPRITE_SUPER_ANNOYED],
    'comforted': [SPRITE_COMFORTED],
    'reading': [SPRITE_READING, SPRITE_READING_LEFT, SPRITE_READING_RIGHT],
    'push_glasses': [SPRITE_PUSH_GLASSES_1, SPRITE_PUSH_GLASSES_2, SPRITE_READING],
}

for state, frames in _EXTRA_SPRITES.items():
    SPRITES['normal'][state] = frames
    SPRITES['fat'][state] = [_make_fat(f) for f in frames]
    SPRITES['thin'][state] = [_make_thin(f) for f in frames]

# 梦境图标列表
DREAM_ICONS_GOOD = [DREAM_ICON_STAR, DREAM_ICON_HEART, DREAM_ICON_RAINBOW]
DREAM_ICONS_BAD = [NIGHTMARE_ICON_LIGHTNING, NIGHTMARE_ICON_SKULL, NIGHTMARE_ICON_EXCLAIM]

# 随机开心事件配件列表
HAPPY_EVENT_SPRITES = {
    'butterfly': SPRITE_BUTTERFLY,
    'cookie': SPRITE_COOKIE,
    'music': SPRITE_MUSIC_NOTE,
}


def get_current_season() -> str:
    """根据当前月份获取季节"""
    from datetime import datetime
    month = datetime.now().month
    if month in [12, 1, 2]:
        return 'winter'
    elif month in [3, 4, 5]:
        return 'spring'
    elif month in [6, 7, 8]:
        return 'summer'
    else:
        return 'autumn'


def get_season_accessory() -> List[List[int]]:
    """获取当前季节的配件"""
    season = get_current_season()
    return SEASON_ACCESSORIES.get(season, [])


def get_all_colors(vitality: float) -> Dict[int, str]:
    """获取所有颜色（包括基础色、季节配件色、动画道具色）"""
    colors = get_dynamic_colors(vitality)
    colors.update(SEASON_COLORS)
    colors.update(ANIMATION_COLORS)
    return colors


def get_sprite_frames(state: str) -> List[List[List[int]]]:
    """获取指定状态的精灵帧列表"""
    return SPRITES.get(state, SPRITES['idle'])


def get_sprite_size() -> tuple:
    """返回精灵图的像素尺寸 (宽, 高)"""
    return (10 * PIXEL_SIZE, 9 * PIXEL_SIZE)


def get_canvas_size(body_type: str = 'normal') -> tuple:
    pad = PIXEL_SIZE * 2
    width = 12 if body_type == 'fat' else 10
    return (width * PIXEL_SIZE + pad * 2, 9 * PIXEL_SIZE + pad * 2)


def get_sprite(body_type: str, state: str) -> List[List[List[int]]]:
    bt = body_type if body_type in SPRITES else 'normal'
    if state in SPRITES[bt]:
        return SPRITES[bt][state]
    return SPRITES[bt]['idle']
